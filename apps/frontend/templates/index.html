<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Сайт</title>
  <link rel="stylesheet" href="/static/assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/assets/css/main.css">
  <link rel="stylesheet" href="/static/assets/css/dt-global_style.css">
  <link rel="stylesheet" href="/static/assets/css/sweetalert.css">
  <link rel="stylesheet" href="/static/assets/css/sweetalert2.min.css">
  <link rel="stylesheet" href="/static/assets/css/jquery-ui.min.css">

  <link rel="icon" type="image/x-icon" href="/static/assets/img/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">

  <script src="/static/assets/js/jquery.min.js"></script>
  <script src="/static/assets/js/jquery-ui.min.js"></script>
  <script src="/static/assets/js/popper.min.js"></script>
  <script src="/static/assets/js/bootstrap.min.js"></script>
  <script src="/static/assets/js/sweetalert.js"></script>
  <script src="/static/assets/js/sweetalert2.min.js"></script>
  <script src="/static/assets/js/custom-sweetalert.js"></script>
</head>

<body>
  <div class="main-container" id="container">
    <div id="content" class="main-content">
      <div class="layout-px-spacing">
        <div class="row layout-top-spacing" id="cancel-row">
          <div class="col-12">
            <div class="layout-spacing">
              <div class="mt-4 col-lg-8 col-md-12 col-sm-12 offset-lg-2">
                <div class="widget widget-content-area">
                  <div class="widget-header">
                    <h5 class="mt-2 text-center">Employees</h5>
                    <hr class="mb-2">
                  </div>
                  <button class="btn btn-success" data-toggle="modal" data-target="#add-employee-modal">Add</button>
                  <hr>
                  <table class="table">
                    <thead>
                      <tr>
                        <th class="th-content">№</th>
                        <th class="th-content">Full name</th>
                        <th class="th-content">Department</th>
                        <th class="th-content">Language</th>
                        <th class="th-content">Actions</th>
                      </tr>
                    </thead>
                    <tbody id="tbody">
                      {% for employee in employees %}
                      <tr>
                        <td class="td-content"><strong>{{ employee.id }}</strong></td>
                        <td class="td-content">
                          <strong>{{ employee.get_full_name }}</strong>
                        </td>
                        <td class="td-content">
                          <span class="badge badge-info">
                            {{ employee.department }}
                          </span>
                        </td>
                        <td class="td-content">
                          <span class="badge outline-badge-success">
                            {{ employee.language }}
                          </span>
                        </td>
                        <td class="td-content">
                          <div class="pl-3 dropdown">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink2"
                              data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-more-horizontal">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="19" cy="12" r="1"></circle>
                                <circle cx="5" cy="12" r="1"></circle>
                              </svg>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuLink2">
                              <a class="dropdown-item action-edit" href="apps_invoice-edit.html"><svg
                                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                  fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                  stroke-linejoin="round" class="feather feather-edit-3">
                                  <path d="M12 20h9"></path>
                                  <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z">
                                  </path>
                                </svg>
                                Edit
                              </a>
                              <a class="dropdown-item action-delete" href="javascript:void(0);"><svg
                                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                  fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                  stroke-linejoin="round" class="feather feather-trash">
                                  <polyline points="3 6 5 6 21 6"></polyline>
                                  <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                  </path>
                                </svg>
                                Delete
                              </a>
                            </div>
                          </div>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                    <tfoot>
                      <tr>
                        <th class="th-content">№</th>
                        <th class="th-content">Full name</th>
                        <th class="th-content">Department</th>
                        <th class="th-content">Language</th>
                        <th class="th-content">Actions</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="add-employee-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            Add employee
          </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">

          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="pl-2 text-primary" for=""><strong>First name:</strong></label>
            <input id="employee-add-first-name" type="text" class="form-control" placeholder="first name" required>
          </div>
          <script>
            var name_tags = [{% for name in name_tags %} "{{ name }}", {% endfor %}];
            $("#employee-add-first-name").autocomplete({
              source: name_tags,
              appendTo: "#add-employee-modal",
            });
          </script>
          <div class="form-group">
            <label class="pl-2 text-primary" for=""><strong>Last name:</strong></label>
            <input type="text" id="employee-add-last-name" class="form-control" placeholder="last name" required>
          </div>
          <div class="form-group">
            <label class="pl-2 text-primary" for=""><strong>Age:</strong></label>
            <input type="text" id="employee-add-age" class="form-control" placeholder="age" required>
          </div>
          <div class="form-group">
            <label class="pl-2 text-primary" for="employee-add-department-select"><strong>Department:</strong></label>
            <select id="employee-add-department-select" class="form-control" required>
              {% for department in departments %}
              <option value="{{ department.id }}">{{ department.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label class="pl-2 text-primary" for="employee-add-language-select"><strong>Language:</strong></label>
            <select id="employee-add-language-select" class="form-control" required>
              {% for language in languages %}
              <option value="{{ language.id }}">{{ language.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn" data-dismiss="modal">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" onclick="employee_add()">
            Create
          </button>
        </div>
        <script>
          function employee_add(){
            var first_name = $("#employee-add-first-name").val();
            var last_name = $("#employee-add-last-name").val();
            var age = $("#employee-add-age").val();
            var department = $("#employee-add-department-select").val();
            var language = $("#employee-add-language-select").val();
            var data = {
              first_name: first_name,
              last_name: last_name,
              age: age,
              department: department,
              language: language,
              "csrfmiddlewaretoken": "{{ csrf_token }}",
            }
            $.post('/add/', data, function(data){
              if(data.success){
                const toast = swal.mixin({
                  toast: true,
                  position: 'top-end',
                  showConfirmButton: false,
                  timer: 3000,
                  padding: '2em'
                });

                toast({
                  type: 'success',
                  title: 'Successfully added',
                  padding: '2em',
                })
                $('#add-employee-modal').modal('hide');
                $("#tbody").append(`
                  <tr>                
                  <td class="td-content"><strong>${data.id}</strong></td>
                        <td class="td-content">
                          <strong>${first_name} ${last_name}</strong>
                        </td>
                        <td class="td-content">
                          <span class="badge badge-info">
                            ${data.department}
                          </span>
                        </td>
                        <td class="td-content">
                          <span class="badge outline-badge-success">
                            ${data.language}
                          </span>
                        </td>
                        <td class="td-content">
                          <div class="pl-3 dropdown">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink2"
                              data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-more-horizontal">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="19" cy="12" r="1"></circle>
                                <circle cx="5" cy="12" r="1"></circle>
                              </svg>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuLink2">
                              <a class="dropdown-item action-edit" href="apps_invoice-edit.html"><svg
                                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                  fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                  stroke-linejoin="round" class="feather feather-edit-3">
                                  <path d="M12 20h9"></path>
                                  <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z">
                                  </path>
                                </svg>
                                Edit
                              </a>
                              <a class="dropdown-item action-delete" href="javascript:void(0);"><svg
                                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                  fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                  stroke-linejoin="round" class="feather feather-trash">
                                  <polyline points="3 6 5 6 21 6"></polyline>
                                  <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                  </path>
                                </svg>
                                Delete
                              </a>
                            </div>
                          </div>
                        </td>
                        </tr>
              `)
              } else {
                const toast = swal.mixin({
                  toast: true,
                  position: 'top-end',
                  showConfirmButton: false,
                  timer: 3000,
                  padding: '2em'
                });

                toast({
                  type: 'error',
                  title: 'Error!',
                  padding: '2em',
                })
              }
            });
          }
        </script>
      </div>
    </div>
  </div>

</body>

</html>